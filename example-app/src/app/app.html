<main class="page">
  <section class="card" aria-labelledby="page-title">
    <header class="header">
      <p class="eyebrow">health-demo plugin</p>
      <h1 id="page-title">Echo Demo</h1>
      <p class="subtitle">
        Calls the Capacitor plugin `echo` method and prints the response. On web
        it will report that the method is not implemented.
      </p>
    </header>

    <div class="field">
      <label class="label" for="echo-input">Message</label>
      <input id="echo-input" class="input" type="text" inputmode="text" autocomplete="off" spellcheck="false"
        [value]="inputValue()" (input)="onInput($event)" placeholder="Type a message to echo" />
    </div>

    <div class="actions">
      <button type="button" class="button" [disabled]="!canEcho()" (click)="runEcho()">
        @if (isBusy()) {
        <span class="spinner" aria-hidden="true"></span>
        Sending…
        } @else {
        Echo
        }
      </button>
    </div>

    <div class="actions">
      <button type="button" class="button secondary" [disabled]="!canCheck()" (click)="checkAvailability()">
        @if (isChecking()) {
        <span class="spinner" aria-hidden="true"></span>
        Checking…
        } @else {
        Check Availability
        }
      </button>
    </div>

    @if (availability()) {
    <div class="result" aria-live="polite">
      <span class="result-label">Health Connect</span>
      <span class="result-value">
        @if (availability()!.available) {
        Available on {{ availability()!.platform }}
        } @else {
        Not available on {{ availability()!.platform }}
        }
      </span>
    </div>
    }

    @if (echoValue()) {
    <div class="result" aria-live="polite">
      <span class="result-label">Echo result</span>
      <span class="result-value">{{ echoValue() }}</span>
    </div>
    }

    @if (errorMessage()) {
    <div class="error" role="alert">
      {{ errorMessage() }}
    </div>
    }
  </section>

  <section class="card" aria-labelledby="auth-title">
    <header class="header">
      <h2 id="auth-title">Authorization</h2>
      <p class="subtitle">
        Test requestAuthorization and checkAuthorizationStatus methods.
      </p>
    </header>

    <div class="actions">
      <button type="button" class="button" [disabled]="!canRequestAuth()" (click)="requestAuth()">
        @if (isRequestingAuth()) {
        <span class="spinner" aria-hidden="true"></span>
        Requesting…
        } @else {
        Request Authorization
        }
      </button>
    </div>

    <div class="actions">
      <button type="button" class="button secondary" [disabled]="!canCheckAuth()" (click)="checkAuth()">
        @if (isCheckingAuth()) {
        <span class="spinner" aria-hidden="true"></span>
        Checking…
        } @else {
        Check Authorization Status
        }
      </button>
    </div>

    @if (authStatus()) {
    <div class="result" aria-live="polite">
      <span class="result-label">Read Permissions</span>
      <div class="result-value">
        @for (key of getAuthStatusKeys(); track key) {
        <div>{{ key }}: {{ authStatus()!.read[key] }}</div>
        }
      </div>
    </div>
    <div class="result" aria-live="polite">
      <span class="result-label">Write Permissions</span>
      <div class="result-value">
        @for (key of getAuthStatusKeys(); track key) {
        <div>{{ key }}: {{ authStatus()!.write[key] }}</div>
        }
      </div>
    </div>
    }
  </section>

  <section class="card" aria-labelledby="data-title">
    <header class="header">
      <h2 id="data-title">Data Operations</h2>
      <p class="subtitle">
        Test writeSamples and readSamples methods with various types.
      </p>
    </header>

    <div class="field">
      <label class="label" for="data-type">Data Type</label>
      <select id="data-type" class="input" (change)="onTypeChange($event)">
        @for (type of availableTypes; track type) {
        <option [value]="type" [selected]="type === selectedType()">{{ type }}</option>
        }
      </select>
    </div>

    <div class="field">
      <label class="label" for="data-value">Value to Write</label>
      <input id="data-value" class="input" type="number" [value]="dataValue()" (input)="onDataValueInput($event)" />
    </div>

    <div class="actions">
      <button type="button" class="button" [disabled]="!canWrite()" (click)="writeData()">
        @if (isWriting()) {
        <span class="spinner" aria-hidden="true"></span>
        Writing…
        } @else {
        Write {{ dataValue() }} {{ selectedType() }}
        }
      </button>
    </div>

    <div class="actions">
      <button type="button" class="button secondary" [disabled]="!canRead()" (click)="readData()">
        @if (isReading()) {
        <span class="spinner" aria-hidden="true"></span>
        Reading…
        } @else {
        Read {{ selectedType() }} (Last 24h)
        }
      </button>
    </div>

    @if (writeStatus()) {
    <div class="result" aria-live="polite">
      <span class="result-label">Write Status</span>
      <span class="result-value">{{ writeStatus() }}</span>
    </div>
    }

    @if (readResults()) {
    <div class="result" aria-live="polite">
      <span class="result-label">Read Results ({{ selectedType() }})</span>
      <div class="result-value">
        @for (sample of readResults()!.samples; track sample.startDate) {
        <div class="sample-item">
          <div>Type: {{ sample.type }}</div>
          <div>Value: {{ sample.value }} {{ sample.unit }}</div>
          <div>Start: {{ sample.startDate }}</div>
          <div>End: {{ sample.endDate }}</div>
          <div>Source: {{ sample.sourceName }}</div>
        </div>
        } @empty {
        <div>No samples found for {{ selectedType() }} in the last 24 hours.</div>
        }
      </div>
    </div>
    }
  </section>
</main>